{
  "task_id": "scikit-learn__scikit-learn-25638",
  "condition": "baseline",
  "max_iterations": 1,
  "model": "claude-sonnet-4-5-20250929",
  "final_passed": false,
  "final_test_output": {
    "resolved": false,
    "test_output": "{\n  \"patch_is_None\": false,\n  \"patch_exists\": true,\n  \"patch_successfully_applied\": true,\n  \"resolved\": false,\n  \"tests_status\": {\n    \"FAIL_TO_PASS\": {\n      \"success\": [\n        \"sklearn/metrics/tests/test_classification.py::test_confusion_matrix_pandas_nullable[Int64]\",\n        \"sklearn/metrics/tests/test_classification.py::test_confusion_matrix_pandas_nullable[Float64]\",\n        \"sklearn/metrics/tests/test_classification.py::test_confusion_matrix_pandas_nullable[boolean]\",\n        \"sklearn/preprocessing/tests/test_label.py::test_label_binarizer_pandas_nullable[Int64]\",\n        \"sklearn/preprocessing/tests/test_label.py::test_label_binarizer_pandas_nullable[Float64]\",\n        \"sklearn/preprocessing/tests/test_label.py::test_label_binarizer_pandas_nullable[boolean]\",\n        \"sklearn/utils/tests/test_multiclass.py::test_unique_labels_pandas_nullable[Int64]\",\n        \"sklearn/utils/tests/test_multiclass.py::test_unique_labels_pandas_nullable[Float64]\",\n        \"sklearn/utils/tests/test_multiclass.py::test_unique_labels_pandas_nullable[boolean]\"\n      ],\n      \"failure\": [\n        \"sklearn/utils/tests/test_multiclass.py::test_type_of_target_pandas_nullable\"\n      ]\n    },\n    \"PASS_TO_PASS\": {\n      \"success\": [\n        \"sklearn/metrics/tests/test_classification.py::test_classification_report_dictionary_output\",\n        \"sklearn/metrics/tests/test_classification.py::test_classification_report_output_dict_empty_input\",\n        \"sklearn/metrics/tests/test_classification.py::test_classification_report_zero_division_warning[warn]\",\n        \"sklearn/metrics/tests/test_classification.py::test_classification_report_zero_division_warning[0]\",\n        \"sklearn/metrics/tests/test_classification.py::test_classification_report_zero_division_warning[1]\",\n        \"sklearn/metrics/tests/test_classification.py::test_multilabel_accuracy_score_subset_accuracy\",\n        \"sklearn/metrics/tests/test_classification.py::test_precision_recall_f1_score_binary\",\n        \"sklearn/metrics/tests/test_classification.py::test_precision_recall_f_binary_single_class\",\n        \"sklearn/metrics/tests/test_classification.py::test_precision_recall_f_extra_labels\",\n        \"sklearn/metrics/tests/test_classification.py::test_precision_recall_f_ignored_labels\",\n        \"sklearn/metrics/tests/test_classification.py::test_average_precision_score_score_non_binary_class\",\n        \"sklearn/metrics/tests/test_classification.py::test_average_precision_score_duplicate_values\",\n        \"sklearn/metrics/tests/test_classification.py::test_average_precision_score_tied_values\",\n        \"sklearn/metrics/tests/test_classification.py::test_precision_recall_fscore_support_errors\",\n        \"sklearn/metrics/tests/test_classification.py::test_precision_recall_f_unused_pos_label\",\n        \"sklearn/metrics/tests/test_classification.py::test_confusion_matrix_binary\",\n        \"sklearn/metrics/tests/test_classification.py::test_multilabel_confusion_matrix_binary\",\n        \"sklearn/metrics/tests/test_classification.py::test_multilabel_confusion_matrix_multiclass\",\n        \"sklearn/metrics/tests/test_classification.py::test_multilabel_confusion_matrix_multilabel\",\n        \"sklearn/metrics/tests/test_classification.py::test_multilabel_confusion_matrix_errors\",\n        \"sklearn/metrics/tests/test_classification.py::test_confusion_matrix_normalize[true-f-0.333333333]\",\n        \"sklearn/metrics/tests/test_classification.py::test_confusion_matrix_normalize[pred-f-0.333333333]\",\n        \"sklearn/metrics/tests/test_classification.py::test_confusion_matrix_normalize[all-f-0.1111111111]\",\n        \"sklearn/metrics/tests/test_classification.py::test_confusion_matrix_normalize[None-i-2]\",\n        \"sklearn/metrics/tests/test_classification.py::test_confusion_matrix_normalize_single_class\",\n        \"sklearn/metrics/tests/test_classification.py::test_likelihood_ratios_warnings[params0-samples\",\n        \"sklearn/metrics/tests/test_classification.py::test_likelihood_ratios_warnings[params1-positive_likelihood_ratio\",\n        \"sklearn/metrics/tests/test_classification.py::test_likelihood_ratios_warnings[params2-no\",\n        \"sklearn/metrics/tests/test_classification.py::test_likelihood_ratios_warnings[params3-negative_likelihood_ratio\",\n        \"sklearn/metrics/tests/test_classification.py::test_likelihood_ratios_warnings[params4-no\",\n        \"sklearn/metrics/tests/test_classification.py::test_likelihood_ratios_errors[params0-class_likelihood_ratios\",\n        \"sklearn/metrics/tests/test_classification.py::test_likelihood_ratios\",\n        \"sklearn/metrics/tests/test_classification.py::test_cohen_kappa\",\n        \"sklearn/metrics/tests/test_classification.py::test_matthews_corrcoef_nan\",\n        \"sklearn/metrics/tests/test_classification.py::test_matthews_corrcoef_against_numpy_corrcoef\",\n        \"sklearn/metrics/tests/test_classification.py::test_matthews_corrcoef_against_jurman\",\n        \"sklearn/metrics/tests/test_classification.py::test_matthews_corrcoef\",\n        \"sklearn/metrics/tests/te"
  },
  "iterations": [],
  "ablation": null,
  "solution": "--- a/sklearn/utils/multiclass.py\n+++ b/sklearn/utils/multiclass.py\n@@ -71,6 +71,24 @@\n     return xp.asarray(sorted(ys_labels))\n \n \n+def _is_pandas_na_dtype(y):\n+    \"\"\"Check if y has a pandas nullable dtype.\"\"\"\n+    # Check if it's a pandas object with a nullable dtype\n+    if hasattr(y, \"dtype\") and hasattr(y.dtype, \"name\"):\n+        dtype_name = y.dtype.name\n+        # Pandas nullable dtypes: Int8, Int16, Int32, Int64, Float32, Float64, boolean\n+        if dtype_name in [\"Int8\", \"Int16\", \"Int32\", \"Int64\", \n+                          \"Float32\", \"Float64\", \"boolean\"]:\n+            return True\n+    return False\n+\n+\n+def _convert_pandas_na_dtype(y):\n+    \"\"\"Convert pandas nullable dtype to numpy dtype.\"\"\"\n+    # Use to_numpy() with appropriate dtype and na_value\n+    return y.to_numpy(dtype=y.dtype.numpy_dtype, na_value=np.nan)\n+\n+\n def _is_integral_float(y):\n     return y.dtype.kind == \"f\" and np.all(y.astype(int) == y)\n \n@@ -239,6 +257,11 @@\n     if sparse_pandas:\n         raise ValueError(\"y cannot be class 'SparseSeries' or 'SparseArray'\")\n \n+    # Convert pandas nullable dtypes to numpy before processing\n+    if _is_pandas_na_dtype(y):\n+        y = _convert_pandas_na_dtype(y)\n+        xp, is_array_api = get_namespace(y)\n+\n     if is_multilabel(y):\n         return \"multilabel-indicator\""
}