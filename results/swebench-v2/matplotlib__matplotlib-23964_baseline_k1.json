{
  "task_id": "matplotlib__matplotlib-23964",
  "condition": "baseline",
  "max_iterations": 1,
  "model": "claude-sonnet-4-5-20250929",
  "final_passed": false,
  "final_test_output": {
    "resolved": false,
    "test_output": "{\n  \"patch_is_None\": false,\n  \"patch_exists\": true,\n  \"patch_successfully_applied\": true,\n  \"resolved\": false,\n  \"tests_status\": {\n    \"FAIL_TO_PASS\": {\n      \"success\": [],\n      \"failure\": [\n        \"lib/matplotlib/tests/test_backend_ps.py::test_empty_line\"\n      ]\n    },\n    \"PASS_TO_PASS\": {\n      \"success\": [],\n      \"failure\": [\n        \"lib/matplotlib/tests/test_backend_ps.py::test_savefig_to_stringio[ps-portrait]\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_savefig_to_stringio[ps-landscape]\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_savefig_to_stringio[ps\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_savefig_to_stringio[eps-portrait]\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_savefig_to_stringio[eps-landscape]\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_savefig_to_stringio[eps\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_patheffects\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_transparency[eps]\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_bbox\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_failing_latex\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_text_clip[eps]\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_d_glyph\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_fonttype[3]\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_fonttype[42]\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_linedash\",\n        \"lib/matplotlib/tests/test_backend_ps.py::test_no_duplicate_definition\"\n      ]\n    },\n    \"FAIL_TO_FAIL\": {\n      \"success\": [],\n      \"failure\": []\n    },\n    \"PASS_TO_FAIL\": {\n      \"success\": [],\n      \"failure\": []\n    }\n  }\n}"
  },
  "iterations": [],
  "ablation": null,
  "solution": "--- a/lib/matplotlib/backends/backend_ps.py\n+++ b/lib/matplotlib/backends/backend_ps.py\n@@ -666,6 +666,8 @@ class RendererPS(_backend_pdf_ps.RendererPDFPSBase):\n                 self.set_font(ps_name, fontsize, False)\n                 thetext = \"\\n\".join(f\"{x:g} 0 m /{name:s} glyphshow\"\n                                     for x, name in xs_names)\n+                if curr_stream is None:\n+                    continue\n                 self._pswriter.write(f\"\"\"\\\n gsave\n {self._get_clip_cmd(gc)}\n@@ -673,6 +675,8 @@ class RendererPS(_backend_pdf_ps.RendererPDFPSBase):\n {thetext}\n grestore\n \"\"\")\n+            if stream is None:\n+                continue\n             for ps_name, xs_names in stream:\n                 self.set_font(ps_name, fontsize, False)\n                 thetext = \"\\n\".join(f\"{x:g} 0 m /{name:s} glyphshow\"\n```\n\nWait, I need to look at the actual code more carefully. Let me check the context around line 669-673:\n\nThe issue is that when `stream` (returned by `_text_helpers.get_glyphs_subset()`) is `None`, the code tries to iterate over it. The fix should check if `stream` is not `None` before iterating.\n\nHere's the corrected patch:\n\n<budget:token_budget>\nI need to see the actual code around lines 665-680 to provide the correct fix. Based on the error traceback pointing to line 673 and the suggestion to add a check before line 669, here's the patch:\n</budget:token_budget>\n\n```diff\n--- a/lib/matplotlib/backends/backend_ps.py\n+++ b/lib/matplotlib/backends/backend_ps.py\n@@ -666,6 +666,8 @@ class RendererPS(_backend_pdf_ps.RendererPDFPSBase):\n                 self.set_font(ps_name, fontsize, False)\n                 thetext = \"\\n\".join(f\"{x:g} 0 m /{name:s} glyphshow\"\n                                     for x, name in xs_names)\n+                if curr_stream is None:\n+                    continue\n                 self._pswriter.write(f\"\"\"\\\n gsave\n {self._get_clip_cmd(gc)}\n```\n\nActually, looking more carefully at the structure and the error message, the issue is with the iteration `for ps_name, xs_names in stream:`. The variable `stream` can be `None` when there's an empty line. Let me provide the correct fix:\n\n```diff\n--- a/lib/matplotlib/backends/backend_ps.py\n+++ b/lib/matplotlib/backends/backend_ps.py\n@@ -666,6 +666,8 @@ class RendererPS(_backend_pdf_ps.RendererPDFPSBase):\n                 self.set_font(ps_name, fontsize, False)\n                 thetext = \"\\n\".join(f\"{x:g} 0 m /{name:s} glyphshow\"\n                                     for x, name in xs_names)\n+            if curr_stream is None:\n+                continue\n             self._pswriter.write(f\"\"\"\\\n gsave\n {self._get_clip_cmd(gc)}"
}