{
  "task_id": "matplotlib__matplotlib-23476",
  "condition": "baseline",
  "max_iterations": 1,
  "model": "claude-sonnet-4-5-20250929",
  "final_passed": false,
  "final_test_output": {
    "resolved": false,
    "test_output": "{\n  \"patch_is_None\": false,\n  \"patch_exists\": true,\n  \"patch_successfully_applied\": true,\n  \"resolved\": false,\n  \"tests_status\": {\n    \"FAIL_TO_PASS\": {\n      \"success\": [],\n      \"failure\": [\n        \"lib/matplotlib/tests/test_figure.py::test_unpickle_with_device_pixel_ratio\"\n      ]\n    },\n    \"PASS_TO_PASS\": {\n      \"success\": [\n        \"lib/matplotlib/tests/test_figure.py::test_align_labels[png]\",\n        \"lib/matplotlib/tests/test_figure.py::test_align_labels_stray_axes\",\n        \"lib/matplotlib/tests/test_figure.py::test_figure_label\",\n        \"lib/matplotlib/tests/test_figure.py::test_fignum_exists\",\n        \"lib/matplotlib/tests/test_figure.py::test_clf_keyword\",\n        \"lib/matplotlib/tests/test_figure.py::test_figure[png]\",\n        \"lib/matplotlib/tests/test_figure.py::test_figure[pdf]\",\n        \"lib/matplotlib/tests/test_figure.py::test_figure_legend[png]\",\n        \"lib/matplotlib/tests/test_figure.py::test_figure_legend[pdf]\",\n        \"lib/matplotlib/tests/test_figure.py::test_gca\",\n        \"lib/matplotlib/tests/test_figure.py::test_add_subplot_subclass\",\n        \"lib/matplotlib/tests/test_figure.py::test_add_subplot_invalid\",\n        \"lib/matplotlib/tests/test_figure.py::test_suptitle[png]\",\n        \"lib/matplotlib/tests/test_figure.py::test_suptitle[pdf]\",\n        \"lib/matplotlib/tests/test_figure.py::test_suptitle_fontproperties\",\n        \"lib/matplotlib/tests/test_figure.py::test_alpha[png]\",\n        \"lib/matplotlib/tests/test_figure.py::test_too_many_figures\",\n        \"lib/matplotlib/tests/test_figure.py::test_iterability_axes_argument\",\n        \"lib/matplotlib/tests/test_figure.py::test_set_fig_size\",\n        \"lib/matplotlib/tests/test_figure.py::test_axes_remove\",\n        \"lib/matplotlib/tests/test_figure.py::test_figaspect\",\n        \"lib/matplotlib/tests/test_figure.py::test_autofmt_xdate[both]\",\n        \"lib/matplotlib/tests/test_figure.py::test_autofmt_xdate[major]\",\n        \"lib/matplotlib/tests/test_figure.py::test_autofmt_xdate[minor]\",\n        \"lib/matplotlib/tests/test_figure.py::test_change_dpi\",\n        \"lib/matplotlib/tests/test_figure.py::test_invalid_figure_size[1-nan]\",\n        \"lib/matplotlib/tests/test_figure.py::test_invalid_figure_size[-1-1]\",\n        \"lib/matplotlib/tests/test_figure.py::test_invalid_figure_size[inf-1]\",\n        \"lib/matplotlib/tests/test_figure.py::test_invalid_figure_add_axes\",\n        \"lib/matplotlib/tests/test_figure.py::test_subplots_shareax_loglabels\",\n        \"lib/matplotlib/tests/test_figure.py::test_savefig\",\n        \"lib/matplotlib/tests/test_figure.py::test_savefig_warns\",\n        \"lib/matplotlib/tests/test_figure.py::test_savefig_backend\",\n        \"lib/matplotlib/tests/test_figure.py::test_savefig_pixel_ratio[Agg]\",\n        \"lib/matplotlib/tests/test_figure.py::test_savefig_pixel_ratio[Cairo]\",\n        \"lib/matplotlib/tests/test_figure.py::test_figure_repr\",\n        \"lib/matplotlib/tests/test_figure.py::test_valid_layouts\",\n        \"lib/matplotlib/tests/test_figure.py::test_invalid_layouts\",\n        \"lib/matplotlib/tests/test_figure.py::test_add_artist[png]\",\n        \"lib/matplotlib/tests/test_figure.py::test_add_artist[pdf]\",\n        \"lib/matplotlib/tests/test_figure.py::test_fspath[png]\",\n        \"lib/matplotlib/tests/test_figure.py::test_fspath[pdf]\",\n        \"lib/matplotlib/tests/test_figure.py::test_fspath[ps]\",\n        \"lib/matplotlib/tests/test_figure.py::test_fspath[eps]\",\n        \"lib/matplotlib/tests/test_figure.py::test_fspath[svg]\",\n        \"lib/matplotlib/tests/test_figure.py::test_tightbbox\",\n        \"lib/matplotlib/tests/test_figure.py::test_axes_removal\",\n        \"lib/matplotlib/tests/test_figure.py::test_removed_axis\",\n        \"lib/matplotlib/tests/test_figure.py::test_figure_clear[clear]\",\n        \"lib/matplotlib/tests/test_figure.py::test_figure_clear[clf]\",\n        \"lib/matplotlib/tests/test_figure.py::test_clf_not_redefined\",\n        \"lib/matplotlib/tests/test_figure.py::test_picking_does_not_stale\",\n        \"lib/matplotlib/tests/test_figure.py::test_add_subplot_twotuple\",\n        \"lib/matplotlib/tests/test_figure.py::test_animated_with_canvas_change[pdf]\",\n        \"lib/matplotlib/tests/test_figure.py::test_animated_with_canvas_change[eps]\",\n        \"lib/matplotlib/tests/test_figure.py::test_animated_with_canvas_change[png]\",\n        \"lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_basic[x0-png]\",\n        \"lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_basic[x1-png]\",\n        \"lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_all_nested[png]\",\n        \"lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_nested[png]\",\n        \"lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_nested_tuple[png]\",\n        \"lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_empty[x0-None-png]\",\n        \"lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_empty[x1-SKIP-png]\",\n        \"lib/matplotlib/tests/test_figure.py::TestSubplotMosaic::test_empty[x2-0-png]\",\n   "
  },
  "iterations": [],
  "ablation": null,
  "solution": "--- a/lib/matplotlib/figure.py\n+++ b/lib/matplotlib/figure.py\n@@ -2862,6 +2862,8 @@ class Figure(FigureBase):\n         state = super().__getstate__()\n         # The canvas cannot currently be pickled, but this has the benefit\n         # of meaning that a figure can be detached from one canvas, and\n+        # re-attached to another.  Store _original_dpi separately to avoid\n+        # issues with device pixel ratio doubling on unpickle.\n         state.pop(\"canvas\")\n         # Set cached renderer to None -- it can't be pickled -- and we can't\n         # currently re-attach it to a figure on a new canvas.\n@@ -2874,6 +2876,9 @@ class Figure(FigureBase):\n         state[\"_cachedRenderer\"] = None\n         # discard any changes to the dpi due to pixel ratio changes\n         state[\"_dpi\"] = state.get('_original_dpi', state['_dpi'])\n+        # Also ensure _original_dpi is in the state if it exists\n+        if hasattr(self, '_original_dpi'):\n+            state['_original_dpi'] = self._original_dpi\n         return state\n \n     def __setstate__(self, state):"
}