{
  "task_id": "django__django-11039",
  "condition": "lucid",
  "max_iterations": 3,
  "model": "claude-sonnet-4-5-20250929",
  "final_passed": true,
  "final_test_output": {
    "resolved": true,
    "test_output": "{\n  \"patch_is_None\": false,\n  \"patch_exists\": true,\n  \"patch_successfully_applied\": true,\n  \"resolved\": true,\n  \"tests_status\": {\n    \"FAIL_TO_PASS\": {\n      \"success\": [\n        \"test_sqlmigrate_for_non_transactional_databases (migrations.test_commands.MigrateTests)\"\n      ],\n      \"failure\": []\n    },\n    \"PASS_TO_PASS\": {\n      \"success\": [\n        \"test_makemigrations_app_name_specified_as_label (migrations.test_commands.AppLabelErrorTests)\",\n        \"test_makemigrations_nonexistent_app_label (migrations.test_commands.AppLabelErrorTests)\",\n        \"test_migrate_app_name_specified_as_label (migrations.test_commands.AppLabelErrorTests)\",\n        \"test_migrate_nonexistent_app_label (migrations.test_commands.AppLabelErrorTests)\",\n        \"test_showmigrations_app_name_specified_as_label (migrations.test_commands.AppLabelErrorTests)\",\n        \"test_showmigrations_nonexistent_app_label (migrations.test_commands.AppLabelErrorTests)\",\n        \"test_sqlmigrate_app_name_specified_as_label (migrations.test_commands.AppLabelErrorTests)\",\n        \"test_sqlmigrate_nonexistent_app_label (migrations.test_commands.AppLabelErrorTests)\",\n        \"test_squashmigrations_app_name_specified_as_label (migrations.test_commands.AppLabelErrorTests)\",\n        \"test_squashmigrations_nonexistent_app_label (migrations.test_commands.AppLabelErrorTests)\",\n        \"--squashed-name specifies the new migration's name.\",\n        \"--squashed-name also works if a start migration is omitted.\",\n        \"test_squashmigrations_initial_attribute (migrations.test_commands.SquashMigrationsTests)\",\n        \"test_squashmigrations_invalid_start (migrations.test_commands.SquashMigrationsTests)\",\n        \"test_squashmigrations_optimizes (migrations.test_commands.SquashMigrationsTests)\",\n        \"test_squashmigrations_squashes (migrations.test_commands.SquashMigrationsTests)\",\n        \"test_squashmigrations_valid_start (migrations.test_commands.SquashMigrationsTests)\",\n        \"test_ticket_23799_squashmigrations_no_optimize (migrations.test_commands.SquashMigrationsTests)\",\n        \"test_failing_migration (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_files_content (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigration_merge_dry_run (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigration_merge_dry_run_verbosity_3 (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_auto_now_add_interactive (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_check (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_conflict_exit (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_consistency_checks_respect_routers (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_default_merge_name (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_disabled_migrations_for_app (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_dry_run (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_dry_run_verbosity_3 (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_empty_connections (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_empty_migration (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_empty_no_app_specified (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_handle_merge (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_inconsistent_history (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_interactive_accept (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_interactive_by_default (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_interactive_reject (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_merge_dont_output_dependency_operations (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_merge_no_conflict (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_migration_path_output (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_migration_path_output_valueerror (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_migrations_announce (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_migrations_modules_nonexistent_toplevel_package (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_migrations_modules_path_not_exist (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_no_apps_initial (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_no_changes (migrations.test_commands.MakeMigrationsTests)\",\n        \"test_makemigrations_no_changes_no_apps (migrations.test_commands.MakeMigration"
  },
  "iterations": [
    {
      "iteration": 1,
      "verification": "ALL TESTS PASSED",
      "passed": true,
      "early_stop": true
    }
  ],
  "ablation": null,
  "solution": "--- a/django/core/management/commands/sqlmigrate.py\n+++ b/django/core/management/commands/sqlmigrate.py\n@@ -57,7 +57,7 @@ class Command(BaseCommand):\n         targets = [(app_label, migration.name)]\n \n         # Show begin/end around output only for atomic migrations\n-        self.output_transaction = migration.atomic\n+        self.output_transaction = migration.atomic and connection.features.can_rollback_ddl\n \n         # Make a plan that represents just the requested migrations and show SQL\n         # for it\n--- a/tests/migrations/test_commands.py\n+++ b/tests/migrations/test_commands.py\n@@ -1235,6 +1235,23 @@ class MigrateTests(MigrationTestBase):\n         out = io.StringIO()\n         call_command(\"sqlmigrate\", \"migrations\", \"0001\", stdout=out)\n         self.assertNotIn(connection.ops.start_transaction_sql(), out.getvalue().lower())\n+\n+    @override_settings(MIGRATION_MODULES={'migrations': 'migrations.test_migrations'})\n+    def test_sqlmigrate_for_non_transactional_databases(self):\n+        \"\"\"\n+        sqlmigrate doesn't wrap output in BEGIN/COMMIT if the database\n+        doesn't support transactional DDL.\n+        \"\"\"\n+        out = io.StringIO()\n+        with mock.patch.object(\n+            connection.features,\n+            'can_rollback_ddl',\n+            False,\n+        ):\n+            call_command('sqlmigrate', 'migrations', '0001', stdout=out)\n+        output = out.getvalue().lower()\n+        self.assertNotIn(connection.ops.start_transaction_sql().lower(), output)\n+        self.assertNotIn(connection.ops.end_transaction_sql().lower(), output)\n \n     @override_settings(\n         INSTALLED_APPS=["
}