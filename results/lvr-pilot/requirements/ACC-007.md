## ACC-007: Payment Detail

**Route:** /accounting/payments/:id
**Component:** src/pages/accounting/PaymentDetailPage.tsx
**Guard:** accounting.invoices.read (via ROUTE_PERMISSION_MAP['accounting'])

### Roles
- Full access (bypass): super_admin, owner, operations_manager
- Navigation-level: Not explicitly defined in NAVIGATION_PERMISSIONS for payments
- Route guard resolves to: DENIED for all non-FULL_ACCESS_ROLES (accounting.invoices.read not in permissionMappings.ts)

### Database
- Primary: `payments`
- Joins: `customers` (id, name, email), `invoices` (id, invoice_number, total_amount)
- Filters: id (from URL params), business_id (from useBusiness)

### Behavior
1. Fetches single payment by id + business_id using Supabase `.single()` with customer and invoice joins
2. Displays tabbed layout: Details, Allocation, Activity
3. Details tab shows: amount, status, payment_date, payment_method, reference_number, customer name, notes
4. Allocation tab shows linked invoice details (invoice_number, total_amount, payment amount) if invoice exists, else placeholder text
5. Activity tab shows created_at and updated_at timestamps
6. Status badges for: pending, completed, failed, cancelled, refunded
7. Payment method badges for: cash, check, credit_card, bank_transfer, online
8. Related Records sidebar: "View Customer" link to /crm/customers/:id, "View Invoice" link to /accounting/invoices/:id
9. Edit button navigates to /accounting/payments/:id/edit (route may not exist)
10. "Process Refund" button shows toast "Refund processing coming in v2.0" — NOT IMPLEMENTED
11. "Print Receipt" button shows toast "Receipt printing coming in v2.0" — NOT IMPLEMENTED
12. Back button navigates to /accounting/accounts-payable (not /accounting/payments)
13. Error state "Go to Payments List" button navigates to /accounting/payments
14. No delete functionality on this page
15. Summary sidebar shows amount, method badge, status badge, date, reference number

### Scaffolding Flags
- Process Refund: line 116-121 — shows toast "Refund processing coming in v2.0"
- Print Receipt: line 123-128 — shows toast "Receipt printing coming in v2.0"
- Allocation tab placeholder: "Payment allocation details will be displayed here" (line 302-304) when no invoice linked
- Activity tab: comment "Additional activity items would go here" (line 325)
