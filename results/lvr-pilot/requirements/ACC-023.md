## ACC-023: Aging Reports

**Route:** /accounting/aging-reports
**Component:** src/pages/accounting/AgingReportsPage.tsx
**Guard:** accounting.invoices.read (via ROUTE_PERMISSION_MAP['accounting'])

### Roles
- Full access (bypass): super_admin, owner, operations_manager
- Navigation-level: No entry in NAVIGATION_PERMISSIONS
- Route guard resolves to: DENIED for all non-FULL_ACCESS_ROLES

### Database
- AR: `invoices` joined with `customers` (filtered by business_id, balance_due > 0, invoice_date <= asOfDate)
- AP: `expenses` joined with `suppliers` (filtered by business_id, status='approved', expense_date <= asOfDate)
- Filters: business_id, balance thresholds, date constraints

### Behavior
1. Page wraps `AgingReportsTab` in DashboardLayout with Clock icon
2. User selects "As of Date" (defaults to today)
3. Two sub-tabs: "Accounts Receivable" and "Accounts Payable"
4. AR Aging: "Generate A/R Aging" button queries invoices with balance_due > 0
5. AR aging calculation: days overdue = (asOfDate - dueDate) in days, bucketed into Current, 1-30, 31-60, 61-90, 90+ Days
6. AR table shows: Invoice #, Customer, Invoice Date, Due Date, Balance Due, Days Overdue, Aging Bucket
7. AR summary shows: Current, 1-30 Days, 31-60 Days, Over 90 Days amounts (note: summary display accesses `['1-30 Days']` etc. but getAgingSummary stores in `days1to30` etc. - display values will always be 0)
8. "Export A/R Report" generates CSV via data URI
9. AP Aging: "Generate A/P Aging" button queries expenses with status='approved'
10. AP aging assumes 30-day payment terms (hardcoded: `dueDate.setDate(dueDate.getDate() + 30)`)
11. AP table shows: Expense #, Supplier, Expense Date, Due Date, Total Amount, Days Overdue, Aging Bucket
12. AP export generates CSV via data URI
13. Rows with daysOverdue > 90 get destructive background color
14. Customer name fallback: first_name + last_name, then company_name, then 'Unknown Customer'
15. Supplier name fallback: suppliers.name, then 'Unknown Supplier'

### Scaffolding Flags
- AR Summary display bug: `getAgingSummary()` returns object with keys `current`, `days1to30`, `days31to60`, etc. but display accesses `['1-30 Days']` and `['31-60 Days']` and `['Over 90 Days']` which are not keys in the returned object - these will always display as 0/$0
- AP aging hardcodes 30-day payment terms regardless of actual terms
- AP uses `total_amount` not `balance_due` (expenses may not track partial payments)
- No 61-90 Days bucket shown in summary display (jumps from 31-60 to Over 90)
