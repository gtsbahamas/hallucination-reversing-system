## ACC-013: Journal Entry Detail

**Route:** /accounting/journal-entries/:id
**Component:** src/pages/accounting/JournalEntryDetailPage.tsx
**Guard:** accounting.invoices.read (via ROUTE_PERMISSION_MAP['accounting'])

### Roles
- Full access (bypass): super_admin, owner, operations_manager
- Navigation-level: FINANCIAL_ROLES, requiredPermissions: ['financial.journal_entries.create', 'financial.journal_entries.view']
- Route guard resolves to: DENIED for all non-FULL_ACCESS_ROLES (accounting.invoices.read not in permissionMappings.ts)

### Database
- Primary: journal_entries (direct Supabase query, filtered by id + business_id)
- Joins: journal_entry_lines -> chart_of_accounts (name, code)
- Uses: useBusiness hook for currentBusiness.id context

### Behavior
1. Fetches journal entry by id from URL params, filtered by business_id
2. Fetches journal_entry_lines joined with chart_of_accounts (name, code) ordered by id
3. Displays entry header with: entry_number, description, status badge, balanced/unbalanced indicator
4. Status badges: draft (gray), posted (green), reversed (red), pending (yellow)
5. Balance check: compares total_debits vs total_credits with 0.01 tolerance
6. 3 content tabs: Details, Journal Lines, Activity
7. Details tab shows: entry_number, status, entry_date, reference, description, total debits/credits, balance status, notes
8. Journal Lines tab shows table: Account (name + code), Description, Debit, Credit, with totals row
9. Activity tab shows created_at and updated_at timestamps (minimal — comment says "Additional activity items would go here")
10. Draft entries: "Post Entry" button (requires balanced), "Edit" button (navigates to /journal-entries/:id/edit), "Discard Draft" button
11. Posted entries: "Reverse Entry" button with confirm dialog
12. Sidebar: Quick Actions card (Post/Reverse/Print/Export) + Entry Summary card
13. "Print Entry" button shows toast: "Journal entry printing coming in v2.0"
14. "Export to PDF" button shows toast: "PDF export coming in v2.0"
15. handlePost calls handleStatusUpdate('posted') which does a direct Supabase update — NOT using journalEntryService.postJournalEntry
16. handleReverse calls handleStatusUpdate('reversed') — does NOT create a reversing entry, just changes status
17. handleDeleteDraft updates status to 'voided' for draft entries only, with confirm dialog
18. Error/not-found state shows "Back to Journal Entries" button and informational message
19. Loading state shows spinner

### Scaffolding Flags
- COMING SOON: "Print Entry" shows toast "coming in v2.0" (line 234-237)
- COMING SOON: "Export to PDF" shows toast "coming in v2.0" (line 240-244)
- BUG: handlePost (line 223-225) does a simple status update instead of using journalEntryService.postJournalEntry — does NOT validate balance, does NOT update GL account balances, does NOT validate period, does NOT create audit trail
- BUG: handleReverse (line 227-231) just changes status to 'reversed' — does NOT create a reversing journal entry, does NOT reverse account balances. The list page (JournalEntriesTab) uses voidJournalEntry which properly creates reversing entries.
- INCOMPLETE: Activity tab only shows created_at and updated_at — no actual activity log
