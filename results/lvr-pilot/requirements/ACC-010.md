## ACC-010: Accounts Receivable

**Route:** /accounting/accounts-receivable
**Component:** src/pages/accounting/AccountsReceivablePage.tsx (thin wrapper around ARManagementTab)
**Guard:** accounting.invoices.read (via ROUTE_PERMISSION_MAP['accounting'])

### Roles
- Full access (bypass): super_admin, owner, operations_manager
- Navigation-level: FINANCIAL_ROLES + ar_specialist, requiredPermissions: ['financial.ar.view']
- Route guard resolves to: DENIED for all non-FULL_ACCESS_ROLES (accounting.invoices.read not in permissionMappings.ts)

### Database
- Primary: invoices (via useAccountsReceivable -> AccountsReceivableService)
- Joins: customers (via useARAnalytics -> supabase.from('customers').select('..., invoices(...)'))
- Snapshots: ar_snapshots (via useARAnalytics)
- Filters: business_id, status in ['sent', 'overdue'], due_date ordering

### Behavior
1. Page is a thin wrapper: renders DashboardLayout > ARManagementTab
2. ARManagementTab uses two hooks: useAccountsReceivable (returns invoices) and useARAnalytics (returns snapshots)
3. ARManagementTab destructures `{ arTransactions, loading }` from useAccountsReceivable BUT the hook returns `{ invoices, ... }` NOT `arTransactions` â€” this means arTransactions is always undefined
4. Summary metrics (Total AR, Overdue Amount) are computed from arTransactions which is undefined, so they always show $0
5. Collection Rate and Avg Days to Pay come from useARAnalytics snapshots (ar_snapshots table) which do have real data
6. 12 sub-tabs across 2 rows: Customers, Payments, Credit Apps, Follow-Up, Analytics, Statements, Credit, Collections, Plans, Portal, Invoices, Subscriptions
7. All sub-tab components are lazy-loaded with React.lazy() and Suspense
8. Sub-tab components: CustomerDashboard, CustomerPaymentsTab, CreditApplicationPanel, FollowUpReportsPanel, ARAnalyticsPanel, CustomerStatementsPanel, CreditManagementPanel, CollectionManagementPanel, PaymentPlansPanel, OnlinePaymentPortal, InvoicesTab, SubscriptionManagementDashboard

### Scaffolding Flags
- BUG: arTransactions is destructured from useAccountsReceivable but the hook does not export arTransactions (it exports invoices). Result: summary metrics Total AR and Overdue Amount always show $0.
- None of the 12 sub-tab lazy-loaded components were individually verified in this requirement (each would need its own deep read)
