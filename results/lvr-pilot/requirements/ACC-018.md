## ACC-018: Budget Analysis

**Route:** /accounting/budget-analysis
**Component:** src/pages/accounting/BudgetAnalysisPage.tsx
**Guard:** accounting.invoices.read (via ROUTE_PERMISSION_MAP['accounting'])

### Roles
- Full access (bypass): super_admin, owner, operations_manager
- Navigation-level: No entry in NAVIGATION_PERMISSIONS
- Route guard resolves to: DENIED for all non-FULL_ACCESS_ROLES

### Database
- Primary: `budgets` (fetched on mount, filtered by business_id)
- Primary: `budget_line_items` joined with `chart_of_accounts` (for budget vs actual)
- Primary: `account_transactions` joined with `chart_of_accounts` and `journal_entries` (for actuals)
- Filters: business_id, budget_id, date range on journal_entries.entry_date

### Behavior
1. Page wraps `BudgetAnalysisTab` in DashboardLayout with PieChart icon
2. User selects a budget from dropdown (populated from `budgets` table), start date, end date
3. "Generate Analysis" button calls `generateBudgetVsActual(budgetId, startDate, endDate)`
4. Hook fetches budget_line_items for selected budget, then fetches account_transactions for date range
5. Compares budgeted_amount vs actual (debit - credit) per account
6. Calculates variance (actual - budget) and variance percent
7. Results displayed in table: Account (name + code), Budgeted, Actual, Variance, Variance %
8. Variance color-coded: green for >= 0, red for < 0
9. "Export" button generates CSV download via data URI with account details and variance
10. Empty state shows "No Budgets Found" with "Create Budget" button
11. "Create Budget" button in empty state has no onClick handler - it does nothing

### Scaffolding Flags
- "Create Budget" button (line 105 of BudgetAnalysisTab.tsx) has no onClick handler - `<Button>Create Budget</Button>` with no action
- Budget vs actual query on account_transactions does not filter by business_id, only by date range and account_id match. If account_ids are globally unique this works, but if shared across businesses it would include wrong data
- No pagination on budget line items or transaction results
