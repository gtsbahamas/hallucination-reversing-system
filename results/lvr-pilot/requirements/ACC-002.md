## ACC-002: Invoice Detail

**Route:** /accounting/invoices/:id
**Component:** src/pages/accounting/InvoiceDetailPage.tsx
**Guard:** accounting.invoices.read (via ROUTE_PERMISSION_MAP['accounting'])

### Roles
- Full access (bypass): super_admin, owner, operations_manager
- Navigation-level: FINANCIAL_ROLES + ar_specialist (from NAVIGATION_PERMISSIONS)
- Route guard resolves to: DENIED for all non-FULL_ACCESS_ROLES (accounting.invoices.read not in permissionMappings.ts)

### Database
- Primary: `invoices`
- Joins: `customers` (id, name, email, phone, company_name)
- Filters: id (from URL params), business_id (from useBusiness)
- Storage: `invoices` bucket (for PDF upload via Supabase Storage)
- Edge function: `send-email` (for sending invoices)

### Behavior
1. Fetches a single invoice by id + business_id using Supabase `.single()`
2. Displays invoice details in a tabbed layout: Details, Line Items, Payments, Activity
3. "Line Items" tab shows placeholder text: "Line items will be displayed here when invoice line items are implemented"
4. "Payments" tab shows placeholder text: "Payment history will be displayed here when payments are linked to invoices"
5. "Activity" tab shows created_at and updated_at timestamps only
6. Shows customer info sidebar with "View Customer" link to /crm/customers/:id
7. Status update: "Send Invoice" button (draft only) generates PDF via jsPDF, uploads to Supabase Storage, invokes send-email edge function, then marks as 'sent'
8. Status update: "Mark Paid" button (sent/overdue) updates status to 'paid' via Supabase .update()
9. "Download PDF" generates and downloads PDF client-side via jsPDF
10. "Edit" button navigates to /accounting/invoices/:id/edit (route may not exist)
11. "Delete" button shows ConfirmDeleteDialog, then deletes via Supabase .delete() + navigates to /accounting/invoices
12. "Duplicate Invoice" button exists but has NO onClick handler — it does nothing
13. Overdue detection: checks if status === 'sent' && due_date < now (client-side)
14. Summary sidebar shows subtotal, tax, total, status, and days overdue (if applicable)

### Scaffolding Flags
- Line Items tab: placeholder text "Line items will be displayed here when invoice line items are implemented" (line 559-561)
- Payments tab: placeholder text "Payment history will be displayed here when payments are linked to invoices" (line 572-574)
- Activity tab: comment "Additional activity items would go here" (line 594)
- Duplicate Invoice button: no onClick handler (line 680-683)
- Customer join uses `name` field but the customers table in InvoicesPage uses `first_name`/`last_name` — potential schema mismatch
